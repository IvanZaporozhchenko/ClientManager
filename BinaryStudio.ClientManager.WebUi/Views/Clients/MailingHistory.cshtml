@using BinaryStudio.ClientManager.DomainModel.Entities
@using BinaryStudio.ClientManager.DomainModel.Infrastructure
@model BinaryStudio.ClientManager.DomainModel.Entities.Person

@{
    Layout = "";
}

<div id="mailing-history">
    <div>
        <ul class="wrapper">
            <!-- for debug --> 
            @if (Model.RelatedMails != null)
            {
                foreach (var mail in Model.RelatedMails)
                {
                    <div class="row">
                        <li class = "span5 @(mail.Sender.Role == PersonRole.Client ? "client-msg" : "employee-msg")">
                            <span class="emphasis">From: </span>@mail.Sender.FullName<br/>
                            <span class="emphasis">Subject: </span>@mail.Subject<br/>
                            <span class="emphasis">Date: </span>@mail.Date
                            <hr/>

                            @if (mail.Body.Count() > 70)
                            {
                                <span>@(mail.Body.Substring(0, 80))</span>
                                <span class="full-mail">@mail.Body.Substring(80)</span>
                                <span class="icon-chevron-down pull-right" onclick="toggleMail(this)"></span>
                            }
                            else
                            {
                                <span>@mail.Body</span>
                            }
                        
                        </li>                        
                    </div>
                }
            }
        </ul>
    </div>
</div>

<script type="text/javascript">
function toggleMail(self) {
    $(self).parent().children(".full-mail").toggle();
    $(self).toggleClass("icon-chevron-down").toggleClass("icon-chevron-up");
}
</script>
